<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>游戏王概率计算器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../assets/css/styles.css">
</head>

<body>
    <div class="container">
        <h1>游戏王概率计算器</h1>

        <!-- 卡组管理 -->
        <div class="card mb-4">
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                <div class="form-group">
                    <label for="deckList">选择卡组</label>
                    <select id="deckList" class="form-control">
                        <option value="">-- 选择卡组 --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="deckName">卡组名称</label>
                    <input type="text" id="deckName" class="form-control" placeholder="输入卡组名称">
                </div>
                <div class="form-group flex flex--column" style="justify-content: flex-end;">
                    <div class="flex flex--row" style="gap: var(--space-xs);">
                        <button onclick="saveDeck()" class="btn btn--success btn--block">保存</button>
                        <button onclick="loadDeck()" class="btn btn--secondary btn--block">加载</button>
                        <button onclick="deleteDeck()" class="btn btn--danger btn--block">删除</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid mb-4"
            style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-lg);">
            <!-- 卡牌输入 -->
            <div class="card">
                <h2>卡牌输入</h2>
                <div id="cardInputs" class="grid"
                    style="grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); gap: var(--space-sm);"></div>
            </div>

            <!-- 饼图容器 -->
            <div class="card">
                <h2>卡组构成</h2>
                <canvas id="deckPieChart"></canvas>
            </div>
        </div>

        <!-- 抽卡设置 -->
        <div class="card mb-4">
            <h2>抽卡设置</h2>
            <div class="grid"
                style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-md);">
                <div class="form-group">
                    <label for="total">卡组总数</label>
                    <input type="number" id="total" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="draws">抽卡数</label>
                    <input type="number" id="draws" class="form-control" value="5" min="1" max="60">
                </div>
            </div>
        </div>

        <!-- 逻辑判断条件 -->
        <div class="card mb-4">
            <h2>逻辑判断条件</h2>
            <div class="form-group">
                <textarea id="condition" class="form-control" rows="3"
                    placeholder="输入逻辑判断条件，例如：a > 0 && b == 1"></textarea>
            </div>
            <div class="text-muted" style="font-size: 0.8em;">
                <strong>运算符优先级说明：</strong><br>
                1. 括号 () 最高优先级<br>
                2. 逻辑非 !<br>
                3. 乘除 * / %<br>
                4. 加减 + -<br>
                5. 比较 > >= < <===!====!==<br>
                    6. 逻辑与 &&<br>
                    7. 逻辑或 ||<br>
                    <br>
                    在条件表达式中，'=' 是赋值运算符。如果您要判断相等，请使用 '==' 或 '==='。
            </div>
        </div>

        <!-- 计算按钮 -->
        <div class="grid mb-4"
            style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-md);">
            <button onclick="calculate()" class="btn btn--primary">开始计算</button>
            <button onclick="cancelCalculation()" id="cancelBtn" class="btn btn--danger hidden">取消计算</button>
        </div>

        <!-- 进度条 -->
        <div id="progressContainer" class="card hidden mb-4">
            <div class="form-group">
                <label>计算进度</label>
                <progress id="calculationProgress" value="0" max="100" style="width: 100%;"></progress>
                <div id="progressText" class="text-center">等待计算...</div>
            </div>
        </div>

        <!-- 结果输出 -->
        <div class="card">
            <h2>计算结果</h2>
            <div class="grid"
                style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md);">
                <div class="form-group">
                    <label for="probability">概率</label>
                    <input type="text" id="probability" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="validCombinations">满足条件的组合数</label>
                    <input type="text" id="validCombinations" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label for="totalCombinations">总组合数</label>
                    <input type="text" id="totalCombinations" class="form-control" readonly>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="../../assets/js/yu-gi-oh-probability-calculator.js"></script>
</body>

</html>